<?php$_auth = 1;require_once('module/auth.php');if (!$_cfg['Ref_Word'])	GoToURL('');if (_uid()){	setPage('upref', $upref = opReadUser($_user['uRef']));	setPage('reflogin', $upref['uLogin']);	setPage('refurl', $_GS['root_url'] . '?' . $_cfg['Ref_Word'] . '=' . $_user['uLogin']);	$n = $_cfg['Ref_Levels'];	if ($n < 1)		$n = 1;	setPage('maxlevel', $n);	$level = _GETN('level');	if (($level < 1) or ($level > $n))		$level = 1;	setPage('level', $level);	$uuu = array();	$a = array(_uid());	for ($i = 1; $i <= $level; $i++)	{		$a = $db->fetchRows($db->select('Users', 'uID', 'uRef ?i', array($a)), 1, 'uID');		$uuu[$i] = $a;	}	$list = opPageGet(_GETN('page'), 10, 'Users U LEFT JOIN AddInfo ON auID=uID LEFT JOIN Opers_refs_summ AS t1 ON t1.User_ID=U.uID AND t1.Ref_ID='._uid(), 		"U.uID, U.uLogin, U.uMail, AddInfo.aCTS, AddInfo.aCity, t1.*",		'U.uID ?i', array($uuu[$level]),		array(			'aCTS' => array(),			'uLogin' => array(),			'uMail' => array()		), 		_GET('sort'), 'uID'	);	stampTableToStr($list, 'aCTS');	setPage('list', $list);	$list2 = array();	foreach ($_vcurrs as $curr => $cids)	{		$list2[$curr] = $db->fetchIDRows($db->select('Users', "uID,			(SELECT SUM(dZD) FROM Deps WHERE dcCurrID=? and dState>=1 and duID=uID) AS ZDepo",			'uID ?i', array($curr, array_keys($list))), false, 'uID');		$list2[$curr]['ZDepo'] = $db->fetch1($db->select('Deps', 'SUM(dZD)', 			'dcCurrID=? and dState>=1 and duID ?i', array($curr, $uuu[$level])));	}	$list2['ZRef'] = $db->fetch1Row($db->select('Opers_refs_summ', 'SUM(SumUSD) as USD, SUM(SumEUR) as EUR, SUM(SumRUB) as RUB, SUM(SumBTC) as BTC, SUM(SumETH) as ETH, SUM(SumXRP) as XRP', 		"User_ID ?i AND Ref_ID=?d", array($uuu[$level], _uid())));	setPage('list2', $list2);}showPage();?>